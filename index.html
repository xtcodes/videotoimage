<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Frame Extractor</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
* { box-sizing: border-box; font-family: system-ui, sans-serif; margin:0; padding:0; }

body {
  background-color: #f7f7f7;
  color: #333;
  display: flex;
  justify-content: center;
  padding: 20px;
}

.container {
  width: 100%;
  max-width: 600px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 20px;
}

.controls {
  display:flex;
  gap:8px;
  align-items:center;
  margin-bottom: 12px;
}

.upload-btn {
  flex:1;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  padding: 14px;
  background-color:#0078d7;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-size:15px;
  transition: background 0.2s ease;
  position: relative;
}

.upload-btn i { margin-right:8px; }
.upload-btn:hover { background-color:#005fa3; }

.upload-btn input[type="file"] {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

/* Tombol reset */
.reset-btn {
  display:inline-flex;
  align-items:center;
  justify-content:center;
  height:44px;
  min-width:44px;
  padding:0 12px;
  background-color:#0078d7;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
  transition: background 0.2s ease, color 0.2s ease;
}

.reset-btn:hover { background-color:#005fa3; }
.reset-btn.clicked { background-color: #ccc; color: #666; }

#progress {
  font-size: 14px;
  color: #444;
  background-color: #f2f2f2;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px;
  width: 100%;
  margin-bottom: 16px; /* jarak rapi ke frames */
}

#framesHolder.grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  justify-items: center;
}

.frame {
  position: relative;
  width: 100%;
  max-width: 260px;
}

.frame img {
  width: 100%;
  border: 1px solid #ccc;
  border-radius: 8px;
  background-color: #fff;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
  display: block;
}

.frame img:hover { transform: scale(1.03); }

.download-icon {
  position: absolute;
  bottom: 8px;
  right: 10px;
  color: rgba(255,255,255,0.85);
  font-size: 16px;
  cursor: pointer;
  transition: color 0.2s ease, transform 0.2s ease;
  text-shadow: 0 0 3px rgba(0,0,0,0.5);
}

.download-icon:hover { color: #0078d7; transform: scale(1.15); }

.downloaded {
  color: #0078d7 !important;
  text-shadow: none;
  transform: none;
  cursor: default;
}

/* Overlay alert */
.frame .overlay-alert {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: rgba(0,0,0,0.5);
  backdrop-filter: blur(4px);
  color: #fff;
  padding: 8px 14px;
  border-radius: 6px;
  font-size: 14px;
  text-align: center;
  white-space: nowrap;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.frame.show-alert .overlay-alert { opacity: 1; }
.overlay-alert i { color: #28a745; margin-right: 6px; }

@media (max-width: 768px) { #framesHolder.grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 400px) { #framesHolder.grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="container">
  <div class="controls">
    <label class="upload-btn">
      <i class="fa-solid fa-file-video"></i> <span id="uploadText">Upload Video</span>
      <input id="videoInput" type="file" accept="video/*">
    </label>

    <button id="resetBtn" class="reset-btn">
      <i class="fa-solid fa-rotate-left fa-lg"></i>
    </button>
  </div>

  <p id="progress">Ready</p>
  <div id="framesHolder" class="grid"></div>
</div>

<script>
const videoInput = document.querySelector('#videoInput');
const uploadText = document.querySelector('#uploadText');
const resetBtn = document.querySelector('#resetBtn');
const progress = document.querySelector('#progress');
const framesHolder = document.querySelector('#framesHolder');

const video = document.createElement('video');
video.preload = "auto";

const canvas = document.createElement('canvas');
const ctx = canvas.getContext('2d');

let fps = 1;
let startTime, endTime;
let numberFrames = 0;

// Upload video
videoInput.addEventListener('change', function() {
  if (this.files.length > 0) {
    uploadText.textContent = this.files[0].name;
    framesHolder.innerHTML = '';
    progress.textContent = 'Loading...';
    video.src = URL.createObjectURL(this.files[0]);

    // tombol reset kembali normal
    resetBtn.classList.remove('clicked');
  }
});

video.addEventListener('loadeddata', function() {
  startTime = new Date().getTime();
  this.currentTime = 0;
  numberFrames = 0;
  canvas.width = 160;
  canvas.height = canvas.width * this.videoHeight / this.videoWidth;
});

video.addEventListener('seeked', function() {
  drawFrame(this, framesHolder);
  if (this.currentTime < this.duration) {
    this.currentTime += 1 / fps;
    progress.textContent = `${this.currentTime.toFixed(2)} / ${this.duration.toFixed(2)} detik`;
  } else {
    endTime = new Date().getTime();
    const t = (endTime - startTime) / 1000;
    const m = Math.floor(t / 60);
    const s = t - m * 60;

    progress.innerHTML = `<i class="fa-solid fa-clock"></i> Waktu proses: ${m}m ${s.toFixed(2)}s<br/><i class="fa-solid fa-camera"></i> Jumlah frame: ${numberFrames}`;
    URL.revokeObjectURL(videoInput.src);
  }
});

function drawFrame(v, holder) {
  ctx.filter = 'none';
  ctx.drawImage(v, 0, 0, canvas.width, canvas.height);

  canvas.toBlob(function(blob) {
    const url = URL.createObjectURL(blob);
    const frameDiv = document.createElement('div');
    frameDiv.classList.add('frame');

    const img = document.createElement('img');
    img.src = url;

    const downloadIcon = document.createElement('a');
    downloadIcon.href = url;
    downloadIcon.download = `frame_${numberFrames + 1}.jpg`;
    downloadIcon.classList.add('download-icon');
    downloadIcon.innerHTML = '<i class="fa-solid fa-download"></i>';

    const overlay = document.createElement('div');
    overlay.classList.add('overlay-alert');
    overlay.innerHTML = '<i class="fa-solid fa-check"></i> Sudah diunduh';

    frameDiv.appendChild(img);
    frameDiv.appendChild(downloadIcon);
    frameDiv.appendChild(overlay);
    holder.appendChild(frameDiv);

    downloadIcon.addEventListener('click', (e) => {
      if (downloadIcon.classList.contains('downloaded')) {
        e.preventDefault();
        frameDiv.classList.add('show-alert');
        setTimeout(() => frameDiv.classList.remove('show-alert'), 1500);
        return;
      }

      setTimeout(() => {
        downloadIcon.classList.add('downloaded');
        frameDiv.classList.add('show-alert');
        setTimeout(() => frameDiv.classList.remove('show-alert'), 1500);
      }, 100);
    });

  }, 'image/jpeg', 0.95);

  numberFrames += 1;
}

// Tombol reset
resetBtn.addEventListener('click', () => {
  framesHolder.innerHTML = '';
  progress.textContent = 'Ready';
  videoInput.value = '';
  uploadText.textContent = 'Upload Video';

  // ubah warna tombol reset menjadi abu-abu
  resetBtn.classList.add('clicked');
});
</script>

</body>
</html>
